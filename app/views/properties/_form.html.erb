<div data-controller="property-importer" data-property-importer-import-url-value="<%= import_from_url_properties_path %>">
  <div class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100">
    <h3 class="text-sm font-semibold text-gray-900 mb-3">ðŸš€ Import automatique</h3>
    <p class="text-xs text-gray-600 mb-3">Collez le lien d'une annonce (SeLoger, LeBonCoin, PAP, Bien'ici, Jinka...) pour remplir automatiquement le formulaire</p>

    <div class="flex gap-2">
      <input
        type="url"
        data-property-importer-target="urlInput"
        placeholder="https://..."
        class="flex-1 rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm"
      />
      <button
        type="button"
        data-property-importer-target="importButton"
        data-action="click->property-importer#importFromUrl"
        class="px-4 py-2 rounded-lg text-sm font-medium text-white bg-blue-600 hover:bg-blue-500 whitespace-nowrap"
      >
        Importer depuis l'URL
      </button>
    </div>

    <div data-property-importer-target="status" class="mt-3 hidden"></div>
  </div>

<%= form_with(model: property, class: "space-y-8", data: { property_importer_target: "form" }) do |f| %>
  <% if property.errors.any? %>
    <div class="rounded-lg bg-red-50 p-4">
      <ul class="list-disc list-inside text-sm text-red-700">
        <% property.errors.full_messages.each do |msg| %><li><%= msg %></li><% end %>
      </ul>
    </div>
  <% end %>

  <fieldset>
    <legend class="text-base font-semibold text-gray-900 mb-4">Informations principales</legend>
    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
      <div class="sm:col-span-2">
        <%= f.label :title, "Titre", class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :title, placeholder: "Ex: T3 lumineux centre-ville", class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
      </div>
      <div>
        <%= f.label :price, "Prix affichÃ© (â‚¬)", class: "block text-sm font-medium text-gray-700" %>
        <%= f.number_field :price, step: 1000, min: 0, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
      </div>
      <div>
        <%= f.label :surface, "Surface (mÂ²)", class: "block text-sm font-medium text-gray-700" %>
        <%= f.number_field :surface, step: 0.5, min: 0, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
      </div>
      <div>
        <%= f.label :property_type, "Type", class: "block text-sm font-medium text-gray-700" %>
        <%= f.select :property_type, [["Appartement", "appartement"], ["Maison", "maison"], ["Terrain", "terrain"], ["Loft", "loft"], ["Duplex", "duplex"]], {}, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
      </div>
      <div>
        <%= f.label :condition, "Ã‰tat", class: "block text-sm font-medium text-gray-700" %>
        <%= f.select :condition, [["Ancien", "ancien"], ["Neuf", "neuf"]], {}, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
      </div>
      <div>
        <%= f.label :rooms, "PiÃ¨ces", class: "block text-sm font-medium text-gray-700" %>
        <%= f.number_field :rooms, min: 1, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
      </div>
      <div>
        <%= f.label :bedrooms, "Chambres", class: "block text-sm font-medium text-gray-700" %>
        <%= f.number_field :bedrooms, min: 0, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
      </div>
    </div>
  </fieldset>

  <fieldset>
    <legend class="text-base font-semibold text-gray-900 mb-4">Localisation</legend>
    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
      <div><%= f.label :city, "Ville", class: "block text-sm font-medium text-gray-700" %><%= f.text_field :city, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %></div>
      <div><%= f.label :postal_code, "Code postal", class: "block text-sm font-medium text-gray-700" %><%= f.text_field :postal_code, maxlength: 5, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %></div>
      <div class="sm:col-span-2"><%= f.label :address, "Adresse", class: "block text-sm font-medium text-gray-700" %><%= f.text_field :address, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %></div>
    </div>
  </fieldset>

  <fieldset>
    <legend class="text-base font-semibold text-gray-900 mb-4">Financier</legend>
    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
      <div><%= f.label :agency_fees, "Frais d'agence (â‚¬)", class: "block text-sm font-medium text-gray-700" %><%= f.number_field :agency_fees, step: 100, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %></div>
      <div class="flex items-end pb-2">
        <label class="flex items-center gap-2">
          <%= f.check_box :agency_fees_included, class: "rounded border-gray-300 text-blue-600 focus:ring-blue-500" %>
          <span class="text-sm text-gray-700">Frais inclus dans le prix</span>
        </label>
      </div>
      <div><%= f.label :copro_charges_monthly, "Charges copro/mois (â‚¬)", class: "block text-sm font-medium text-gray-700" %><%= f.number_field :copro_charges_monthly, step: 10, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %></div>
      <div><%= f.label :property_tax_yearly, "Taxe fonciÃ¨re/an (â‚¬)", class: "block text-sm font-medium text-gray-700" %><%= f.number_field :property_tax_yearly, step: 50, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %></div>
      <div><%= f.label :estimated_works, "Travaux estimÃ©s (â‚¬)", class: "block text-sm font-medium text-gray-700" %><%= f.number_field :estimated_works, step: 500, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %></div>
    </div>
  </fieldset>

  <fieldset>
    <legend class="text-base font-semibold text-gray-900 mb-4">CaractÃ©ristiques</legend>
    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
      <div><%= f.label :energy_class, "DPE", class: "block text-sm font-medium text-gray-700" %><%= f.select :energy_class, [["â€”", nil]] + Property::ENERGY_CLASSES.map { |c| [c, c] }, {}, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %></div>
      <div><%= f.label :ges_class, "GES", class: "block text-sm font-medium text-gray-700" %><%= f.select :ges_class, [["â€”", nil]] + Property::ENERGY_CLASSES.map { |c| [c, c] }, {}, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %></div>
      <div><%= f.label :floor, "Ã‰tage", class: "block text-sm font-medium text-gray-700" %><%= f.number_field :floor, min: 0, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %></div>
      <div class="flex items-center gap-6 pt-6">
        <label class="flex items-center gap-2"><%= f.check_box :has_outdoor, class: "rounded border-gray-300 text-blue-600 focus:ring-blue-500" %><span class="text-sm text-gray-700">ExtÃ©rieur</span></label>
        <label class="flex items-center gap-2"><%= f.check_box :has_parking, class: "rounded border-gray-300 text-blue-600 focus:ring-blue-500" %><span class="text-sm text-gray-700">Parking</span></label>
      </div>
    </div>
  </fieldset>

  <fieldset>
    <legend class="text-base font-semibold text-gray-900 mb-4">Ã‰valuation subjective (1-5)</legend>
    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
      <% { score_neighborhood: "Quartier", score_view: "Vue", score_orientation: "Exposition", score_renovation: "Ã‰tat/Travaux", score_quietness: "Calme", score_brightness: "LuminositÃ©" }.each do |field, label| %>
        <div>
          <%= f.label field, label, class: "block text-sm font-medium text-gray-700" %>
          <%= f.select field, [["â€” Non Ã©valuÃ©", nil]] + (1..5).map { |n| ["#{n}/5", n] }, {}, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
        </div>
      <% end %>
    </div>
  </fieldset>

  <fieldset>
    <legend class="text-base font-semibold text-gray-900 mb-4">Autres</legend>
    <div class="space-y-4">
      <div><%= f.label :listing_url, "Lien annonce", class: "block text-sm font-medium text-gray-700" %><%= f.url_field :listing_url, placeholder: "https://...", class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %></div>
      <div><%= f.label :personal_notes, "Notes personnelles", class: "block text-sm font-medium text-gray-700" %><%= f.text_area :personal_notes, rows: 3, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %></div>
      <div><%= f.label :photos, "Photos", class: "block text-sm font-medium text-gray-700" %><%= f.file_field :photos, multiple: true, class: "mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" %></div>
      <div>
        <%= f.label :status, "Statut", class: "block text-sm font-medium text-gray-700" %>
        <%= f.select :status, [["Ã€ analyser", "a_analyser"], ["Ã€ visiter", "a_visiter"], ["VisitÃ©", "visite"], ["Offre faite", "offre_faite"], ["RefusÃ©", "refuse"], ["AcceptÃ©", "accepte"]], {}, class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
      </div>
    </div>
  </fieldset>

  <div class="pt-4">
    <%= f.submit property.new_record? ? "Ajouter le bien" : "Mettre Ã  jour", class: "w-full py-2.5 px-4 rounded-lg text-sm font-medium text-white bg-blue-600 hover:bg-blue-500 cursor-pointer" %>
  </div>
<% end %>
</div>
