<%= form_with(model: [property, renovation_item], class: "space-y-4",
    data: { controller: "renovation", renovation_surface_value: property.surface.to_i }) do |f| %>
  <% if renovation_item.errors.any? %>
    <div class="rounded-lg bg-red-50 p-4">
      <ul class="list-disc list-inside text-sm text-red-700">
        <% renovation_item.errors.full_messages.each do |msg| %><li><%= msg %></li><% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= f.label :category, "Catégorie", class: "block text-sm font-medium text-gray-700" %>
    <%= f.select :category,
        RenovationItem::CATEGORY_LABELS.map { |k, v| [v, k] },
        { include_blank: "— Choisir une catégorie —" },
        class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",
        data: { renovation_target: "category", action: "change->renovation#categoryChanged" } %>
  </div>

  <div>
    <%= f.label :description, "Description (optionnel)", class: "block text-sm font-medium text-gray-700" %>
    <%= f.text_field :description, placeholder: "Ex: Cuisine complète à refaire",
        class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <%= f.label :estimated_cost_min, "Coût min (€)", class: "block text-sm font-medium text-gray-700" %>
      <%= f.number_field :estimated_cost_min, min: 0, step: 100,
          class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",
          data: { renovation_target: "costMin" } %>
    </div>
    <div>
      <%= f.label :estimated_cost_max, "Coût max (€)", class: "block text-sm font-medium text-gray-700" %>
      <%= f.number_field :estimated_cost_max, min: 0, step: 100,
          class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",
          data: { renovation_target: "costMax" } %>
    </div>
  </div>

  <!-- Benchmark hint -->
  <p class="hidden text-xs text-blue-600" data-renovation-target="hint"></p>

  <!-- Energy upgrade note -->
  <div class="hidden rounded-lg bg-green-50 border border-green-200 p-3" data-renovation-target="energyNote">
    <p class="text-xs text-green-800">
      Ces travaux pourraient améliorer votre DPE de 1 à 2 classes. Pensez aux aides
      <a href="https://www.maprimerenov.gouv.fr" target="_blank" rel="noopener" class="underline">MaPrimeRénov'</a>.
    </p>
  </div>

  <div class="pt-1 flex gap-3">
    <%= f.submit renovation_item.new_record? ? "Ajouter" : "Enregistrer",
        class: "px-4 py-2 rounded-lg text-sm font-medium text-white bg-blue-600 hover:bg-blue-500 cursor-pointer" %>
    <%= link_to "Annuler", property, class: "px-4 py-2 rounded-lg text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200" %>
  </div>
<% end %>
